package com.tu.lunchy.dao.impl;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import com.tu.lunchy.dao.objects.Meal;
import com.tu.lunchy.dao.objects.Menu;
import com.tu.lunchy.database.DatabaseConnection;

public class MenuDaoImpl {

	
	public Menu getMenu(int menuId) throws SQLException {
		Connection connection = DatabaseConnection.getConnection();
		Menu menu = null;

		String selectQuery = "select * from menus where menu_id = ?";

		PreparedStatement preparedStatement = connection.prepareStatement(selectQuery);
		preparedStatement.setInt(1, menuId);
		ResultSet resultSet = preparedStatement.executeQuery();

		while (resultSet.next()) {
			String menuName = resultSet.getString("menu_name");

			menu = new Menu(menuName);
		}

		return menu;
	}
	
	private List<Meal> getMealsForMenu(int menuId) {
		Connection connection = DatabaseConnection.getConnection();
		List<Integer> mealIds = new ArrayList<Integer>(); 

		String selectQuery = "select * from menu_meals where menu_id = ?";

		PreparedStatement preparedStatement = connection.prepareStatement(selectQuery);
		preparedStatement.setInt(1, menuId);
		ResultSet resultSet = preparedStatement.executeQuery();

		while (resultSet.next()) {
			int mealId = resultSet.getInt("meal_id");
			mealIds.add(mealId);		
		}

		return getMealsById(mealIds);
	}
	
	private List<Meal> getMealsById(List<Integer> mealIds) throws SQLException {
		List<Meal> meals = new ArrayList<Meal>(); 
		
		MealDaoImpl mealDaoImpl = new MealDaoImpl();
		for (Integer mealId : mealIds) {
			Meal meal = mealDaoImpl.getMeal(mealId);
			meals.add(meal);
		}
		
		return meals;
	}
	
}
